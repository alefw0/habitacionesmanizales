import { NextRequest, NextResponse } from \"next/server\";\n\n/**\n * Proxy unificado para operaciones admin en listings:\n * - GET /api/admin/listings?action=pending → GET /admin/listings/pending\n * - PATCH /api/admin/listings?id={id}&action=publish → PATCH /admin/listings/{id}/publish\n * - PATCH /api/admin/listings?id={id}&action=unpublish → PATCH /admin/listings/{id}/unpublish\n * - DELETE /api/admin/listings?id={id} → DELETE /admin/listings/{id}\n */\n\nconst BACKEND_URL = process.env.BACKEND_URL || \"http://127.0.0.1:8000\";\nconst ADMIN_TOKEN = process.env.ADMIN_TOKEN || \"\";\n\nif (!ADMIN_TOKEN) {\n  console.warn(\"⚠️  ADMIN_TOKEN no está configurado\");\n}\n\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const action = searchParams.get(\"action\");\n\n  // GET /api/admin/listings?action=pending\n  if (action === \"pending\") {\n    return handleGetPending();\n  }\n\n  return NextResponse.json(\n    { error: \"Acción no reconocida. Use ?action=pending\" },\n    { status: 400 }\n  );\n}\n\nexport async function PATCH(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const id = searchParams.get(\"id\");\n  const action = searchParams.get(\"action\");\n\n  if (!id) {\n    return NextResponse.json(\n      { error: \"Falta parámetro: id\" },\n      { status: 400 }\n    );\n  }\n\n  if (action === \"publish\") {\n    return handlePublish(id);\n  } else if (action === \"unpublish\") {\n    return handleUnpublish(id);\n  }\n\n  return NextResponse.json(\n    { error: \"Acción no reconocida. Use ?action=publish o ?action=unpublish\" },\n    { status: 400 }\n  );\n}\n\nexport async function DELETE(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const id = searchParams.get(\"id\");\n\n  if (!id) {\n    return NextResponse.json(\n      { error: \"Falta parámetro: id\" },\n      { status: 400 }\n    );\n  }\n\n  return handleDelete(id);\n}\n\nasync function handleGetPending() {\n  const url = `${BACKEND_URL}/admin/listings/pending`;\n\n  try {\n    const res = await fetch(url, {\n      method: \"GET\",\n      headers: {\n        \"X-Admin-Token\": ADMIN_TOKEN,\n      },\n    });\n\n    const data = await res.json();\n    return NextResponse.json(data, { status: res.status });\n  } catch (err) {\n    console.error(\"Error en proxy pending:\", err);\n    return NextResponse.json(\n      { error: \"Error al obtener listados pendientes\" },\n      { status: 500 }\n    );\n  }\n}\n\nasync function handlePublish(id: string) {\n  const url = `${BACKEND_URL}/admin/listings/${id}/publish`;\n\n  try {\n    const res = await fetch(url, {\n      method: \"PATCH\",\n      headers: {\n        \"X-Admin-Token\": ADMIN_TOKEN,\n      },\n    });\n\n    const data = await res.json();\n    return NextResponse.json(data, { status: res.status });\n  } catch (err) {\n    console.error(\"Error en proxy publish:\", err);\n    return NextResponse.json(\n      { error: \"Error al publicar anuncio\" },\n      { status: 500 }\n    );\n  }\n}\n\nasync function handleUnpublish(id: string) {\n  const url = `${BACKEND_URL}/admin/listings/${id}/unpublish`;\n\n  try {\n    const res = await fetch(url, {\n      method: \"PATCH\",\n      headers: {\n        \"X-Admin-Token\": ADMIN_TOKEN,\n      },\n    });\n\n    const data = await res.json();\n    return NextResponse.json(data, { status: res.status });\n  } catch (err) {\n    console.error(\"Error en proxy unpublish:\", err);\n    return NextResponse.json(\n      { error: \"Error al despublicar anuncio\" },\n      { status: 500 }\n    );\n  }\n}\n\nasync function handleDelete(id: string) {\n  const url = `${BACKEND_URL}/admin/listings/${id}`;\n\n  try {\n    const res = await fetch(url, {\n      method: \"DELETE\",\n      headers: {\n        \"X-Admin-Token\": ADMIN_TOKEN,\n      },\n    });\n\n    const data = await res.json();\n    return NextResponse.json(data, { status: res.status });\n  } catch (err) {\n    console.error(\"Error en proxy delete:\", err);\n    return NextResponse.json(\n      { error: \"Error al eliminar anuncio\" },\n      { status: 500 }\n    );\n  }\n}\n"
